## HAS CODE FOR FINAL VERSION

############### plotting habitat quality grid corr vs difference
plot(y = diffplot, x = Binssubset[,3], xlab = "habitat quality grid correlation", ylab = "difference between year 300 depletion")
lm(diffplot~Binssubset[,3])
cor.lm<- lm(diffplot~Binssubset[,3])
summary(cor.lm)$r.squared
# 0.1032879
abline(a = .06812, b = .08359, col =  "red", lwd = 2)


#plot(y = diffplot, x = Binssubset[,3], xlim = c(-1, 1), col = "white", xlab = "starting grid correlation", ylab = "difference between year 300 depletion")

# plot(y = diffplot, x = Binssubset[,3], xlim = c(1, 100), col = "white")

sgcorr<- rep(NA, length = length(diffplot))
for(i in 1:500){
  # sumtotal<- 0
  # for(j in 1:10){
  #   for(k in 1:10){
  #     if(simdist1[j,k,1,i]> 0 && simdist2[j,k,1,i] >0){
  #       sumtotal<- sumtotal+1
  #     }
  #   }
  # }
  # points(x = sumtotal, y = diffplot[i])
  sgcorr[i]<- cor(c(simdist1[,,1,i]), c(simdist2[,,1,i]))
  points(x = cor(c(simdist1[,,1,i]), c(simdist2[,,1,i])), y = diffplot[i])

}

length(which(sgcorr<0))


############ plotting starting grid correlation vs difference

plot(y = diffplot, x = sgcorr, xlab = "starting grid correlation", ylab = "difference between year 300 depletion")
lm(diffplot~sgcorr)
sgcorr.lm<- lm(diffplot~sgcorr)
summary(sgcorr.lm)$r.squared
# 0.168202
abline(a = .06702, b = .17930, col =  "red", lwd = 2)

########################


pdf("Correlation Grids.pdf", height = 6, width = 8)
numrow<- 1
numcol<- 2
tracker<- 0
par(mfrow = c(numrow, numcol))
par(pch = 16, cex.lab = 1.2, cex.axis = 1)

plot(y = diffplot, x = Binssubset[,3], xlab = "habitat quality grid correlation", ylab = "difference between year 300 depletion")
abline(a = .06812, b = .08359, col =  "red", lwd = 2)

plot(y = diffplot, x = sgcorr, xlab = "starting grid correlation", ylab = "difference between year 300 depletion")
abline(a = .06702, b = .17930, col =  "red", lwd = 2)

dev.off()


################################################################

pdf("Correlation Grids_TB_aug2020.pdf", height = 6, width = 5)
numrow<- 1
numcol<- 1
tracker<- 0
par(mfrow = c(numrow, numcol))
par(cex.lab = 1, cex.axis = 1)

# plot(y = diffplot, x = Binssubset[,3], xlab = "habitat quality grid correlation", ylab = "difference between year 300 depletion")
# abline(a = .06812, b = .08359, col =  "red", lwd = 2)

plot(y = diffplot, x = sgcorr, xlab = "Starting grid correlation", 
     ylab = "Difference between year 300 depletion",las = 1, pch = 21,
     col = "gray20", bg = rgb(red=0.2, green=0.2, blue=0.2, alpha=0.2))
abline(a = .06702, b = .17930, col =  "black", lwd = 2.5)

dev.off()

#######################

diffplotopp<- -1*diffplot
sgcorr.lmopp<- lm(diffplotopp~sgcorr)

pdf("Correlation Grids_TB_November.pdf", height = 6, width = 5)
numrow<- 1
numcol<- 1
tracker<- 0
par(mfrow = c(numrow, numcol))
par(cex.lab = 1, cex.axis = 1)

# plot(y = diffplot, x = Binssubset[,3], xlab = "habitat quality grid correlation", ylab = "difference between year 300 depletion")
# abline(a = .06812, b = .08359, col =  "red", lwd = 2)

plot(y = diffplotopp, x = sgcorr, xlab = "Starting grid correlation", 
     ylab = "Difference between final / initial population sizes",las = 1, pch = 21,
     col = "gray20", bg = rgb(red=0.2, green=0.2, blue=0.2, alpha=0.2))
abline(sgcorr.lmopp, col =  "black", lwd = 2.5)
mtext("Impact of spatial correlation on depletion", side = 3, line= 1)
dev.off()


diffplotopp[which(sgcorr>0.2)] ##31
possgcorr<- which(sgcorr>0.2)
sgcorr[possgcorr[11]] #0.3412184

##458

diffplotopp[which(sgcorr< (-0.2))]
negsgcorr<- which(sgcorr< (-0.2))
sgcorr[negsgcorr[4]]


pdf("Correlation Grids_TB_December.pdf", height = 6, width = 5)
numrow<- 1
numcol<- 1
tracker<- 0
par(mfrow = c(numrow, numcol))
par(cex.lab = 1, cex.axis = 1)

# plot(y = diffplot, x = Binssubset[,3], xlab = "habitat quality grid correlation", ylab = "difference between year 300 depletion")
# abline(a = .06812, b = .08359, col =  "red", lwd = 2)

plot(y = diffplotopp, x = sgcorr, xlab = "Starting grid correlation", 
     ylab = "Difference between final / initial population sizes",las = 1, pch = 21,
     col = "gray20", bg = rgb(red=0.2, green=0.2, blue=0.2, alpha=0.2))
abline(sgcorr.lmopp, col =  "black", lwd = 2.5)

newdat<-seq(from = min(sgcorr), to = max(sgcorr), by =.01)
pred_interval_corrgrid<- predict(sgcorr.lmopp, newdata = data.frame(sgcorr = newdat), interval = "prediction", level = .95 )
lines(newdat, pred_interval_corrgrid[,2], col = "black", lty = 2, lwd = 1.5)
lines(newdat, pred_interval_corrgrid[,3], col = "black", lty = 2, lwd = 1.5)


mtext("Impact of spatial correlation on depletion", side = 3, line= 1)
dev.off()


