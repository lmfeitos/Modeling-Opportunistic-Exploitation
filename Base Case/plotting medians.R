# ## read in data - TWO SPECIEs ==================
yearlysizematrixsp1<- read.table("yearlysizematrixsp1_par24", header = F)
yearlysizematrixsp2<- read.table("yearlysizematrixsp2_par24", header = F)

originalsp1<- yearlysizematrixsp1[1:nsims,]
originalsp2<- yearlysizematrixsp2[1:nsims,]

yearlysizematrixsp1<- yearlysizematrixsp1[1:nsims,]
yearlysizematrixsp2<- yearlysizematrixsp2[1:nsims,]

## make this "depletion" -- divide by initial population number
yearlysizematrixsp1<- yearlysizematrixsp1/yearlysizematrixsp1[1,1]
yearlysizematrixsp2<- yearlysizematrixsp2/yearlysizematrixsp2[1,1]

# yearlysizematrixsp1<- originalsp1
# yearlysizematrixsp2<- originalsp2

## number of simulations
simnum<- nsims

## calculate yearly mean depletion
species1avgbyyr<- apply(yearlysizematrixsp1, 2, FUN = median)
species2avgbyyr<- apply(X = yearlysizematrixsp2, 2, FUN = median)

## calculate yearly sd
# sp1yrsd<- rep(NA, ncol(yearlysizematrixsp1))
# sp2yrsd<- rep(NA, ncol(yearlysizematrixsp2)) 
# 
# for(i in 1:length(sp1yrsd)){
#   sp1yrsd[i]<- sd(yearlysizematrixsp1[,i])
#   sp2yrsd[i]<- sd(yearlysizematrixsp1[,i])
# }

quantilesp1<- matrix(NA, nrow = ncol(yearlysizematrixsp1), ncol = 3) 
quantilesp2<- matrix(NA, nrow = ncol(yearlysizematrixsp2), ncol = 3) 

for(i in 1:nrow(quantilesp1)){
  quantilesp1[i, ]<- quantile(yearlysizematrixsp1[, i], c(.025,.5, .975))
  quantilesp2[i, ]<- quantile(yearlysizematrixsp2[, i], c(.025,.5, .975))
}

nrow(quantilesp1)

## create plotting matrix for sp1  -- includes CI calculations
plottingsp1<- matrix(NA, nrow = nrow(quantilesp1), ncol = 4) #col 1 is year, col 2 is mean, col 3 is lower ci, col 4 is upper ci, 
plottingsp1[,1]<- 0:((nrow(quantilesp1)) - 1) 
plottingsp1[,2]<- quantilesp1[,2] 
plottingsp1[,3]<- quantilesp1[,1]
plottingsp1[,4]<- quantilesp1[,3]

## create plotting matrix for sp2  -- includes CI calculations
plottingsp2<- matrix(NA, nrow = nrow(quantilesp2), ncol = 4) #col 1 is year, col 2 is mean, col 3 is lower ci, col 4 is upper ci, 
plottingsp2[,1]<- 0:(nrow(quantilesp2) - 1)
plottingsp2[,2]<- quantilesp2[,2]
plottingsp2[,3]<- quantilesp2[,1]
plottingsp2[,4]<- quantilesp2[,3]



#########################################################################
#########################################################################
# ## read in data - ONE SPECIEs ==================
# 
yearlysizematrixsp1onesp<- read.table("yearlysizematrixsp1onesp_par24", header = F)
yearlysizematrixsp2onesp<- read.table("yearlysizematrixsp2onesp_par24", header = F)

yearlysizematrixsp1onesp
yearlysizematrixsp2onesp

originalsp1onesp<- yearlysizematrixsp1onesp
originalsp2onesp<- yearlysizematrixsp2onesp


yearlysizematrixsp1onesp<- yearlysizematrixsp1onesp[1:nsims,]
yearlysizematrixsp2onesp<- yearlysizematrixsp2onesp[1:nsims,]

## make this "depletion" -- divide by initial population number
yearlysizematrixsp1onesp<- yearlysizematrixsp1onesp/yearlysizematrixsp1onesp[1,1]
yearlysizematrixsp2onesp<- yearlysizematrixsp2onesp/yearlysizematrixsp2onesp[1,1]

# yearlysizematrixsp1<- originalsp1
# yearlysizematrixsp2<- originalsp2

## number of simulations
simnum<- nsims

## calculate yearly mean depletion
# species1avgbyyronesp<- colMeans(yearlysizematrixsp1onesp)
# species2avgbyyronesp<- colMeans(yearlysizematrixsp2onesp)

# ## calculate yearly sd
# sp1yrsdonesp<- rep(NA, ncol(yearlysizematrixsp1onesp))
# sp2yrsdonesp<- rep(NA, ncol(yearlysizematrixsp2onesp))
# 
# for(i in 1:length(sp1yrsdonesp)){
#   sp1yrsdonesp[i]<- sd(yearlysizematrixsp1onesp[,i])
#   sp2yrsdonesp[i]<- sd(yearlysizematrixsp1onesp[,i])
# }

quantilesp1onesp<- matrix(NA, nrow = ncol(yearlysizematrixsp1onesp), ncol = 3) 
quantilesp2onesp<- matrix(NA, nrow = ncol(yearlysizematrixsp2onesp), ncol = 3) 

for(i in 1:nrow(quantilesp1onesp)){
  quantilesp1onesp[i, ]<- quantile(yearlysizematrixsp1onesp[, i], c(.025,.5, .975))
  quantilesp2onesp[i, ]<- quantile(yearlysizematrixsp2onesp[, i], c(.025,.5, .975))
}

## create plotting matrix for sp1  -- includes CI calculations
plottingsp1onesp<- matrix(NA, nrow = nrow(quantilesp1onesp), ncol = 4) #col 1 is year, col 2 is mean, col 3 is lower ci, col 4 is upper ci, 
plottingsp1onesp[,1]<- 0:(nrow(quantilesp1onesp) - 1)
plottingsp1onesp[,2]<- quantilesp1onesp[,2]
plottingsp1onesp[,3]<- quantilesp1onesp[,1]
plottingsp1onesp[,4]<- quantilesp1onesp[,3]

## create plotting matrix for sp2  -- includes CI calculations
plottingsp2onesp<- matrix(NA, nrow = nrow(quantilesp2onesp), ncol = 4) #col 1 is year, col 2 is mean, col 3 is lower ci, col 4 is upper ci, 
plottingsp2onesp[,1]<- 0:(nrow(quantilesp2onesp) - 1)
plottingsp2onesp[,2]<- quantilesp2onesp[,2]
plottingsp2onesp[,3]<- quantilesp2onesp[,1]
plottingsp2onesp[,4]<- quantilesp2onesp[,3]



#########################################################################
#########################################################################
#########################################################################
#########################################################################
### PLOTTING ONE =====
pdf("Parameter 24.pdf", height = 6, width = 8)
numrow<- 1
numcol<- 2
tracker<- 0
par(mfrow = c(numrow, numcol))
par(pch = 16, cex.lab = 1.2, cex.axis = 1, yaxs = "i", mar = c(3.5,.5,4,1), oma = c(1, 5, 1, 0))


plot(x = plottingsp1onesp[,1], y = plottingsp1onesp[,2], col = "firebrick3",
     #ylim = c(min(plotthis[,c(2,3)])-.05, max(plotthis[,c(2,3)])+.1),
     ylim = c(0,1),
     xaxt = "n", yaxt = "n", ann = FALSE,
     # xlab = "Price ratio", ylab = "Final/Initial population size",
     cex = 1.5)
lines(x = plottingsp1onesp[,1], y = plottingsp1onesp[,3], col = "firebrick3")
lines(x = plottingsp1onesp[,1], y = plottingsp1onesp[,4], col = "firebrick3")

box(col = "gray29")
axis(side = 1, seq(from = 0, to = 250, by = 50), col.ticks = "gray29", col.axis = "gray29" )
#mtext("Revenue ratio", side = 1, line = 2.5, cex = 1.2, col = "gray20")
mtext("Year", side = 1, line = 2.5, cex = 1.2, col = "gray20")
if(tracker%%numcol == 0){
  axis(at = c(0, .2,.4, .6, .8, 1), side = 2, col.ticks = "gray29", col.axis = "gray29" )
  mtext("Final / Initial Population Size", side = 2, line = 2.5, cex = 1.2, col = "gray20")
}
axis(at = c(0, .2,.4, .6, .8, 1), side = 2, col.ticks = "gray29", col.axis = "gray29", labels = FALSE)
points(x= plottingsp2onesp[,1], y = plottingsp2onesp[,2], col = "dodgerblue3", cex = 1.5)
lines(x = plottingsp2onesp[,1], y = plottingsp2onesp[,3], col = "dodgerblue3")
lines(x = plottingsp2onesp[,1], y = plottingsp2onesp[,4], col = "dodgerblue3")
#abline(h = max(plotthis[,2]), lty = 2, lwd = 3)
#abline(h = 0, lty = 2, lwd = 3)

# points(x = 0.26604082, y = .2013813, col = "gray20", cex = 1.5, pch = 1, lwd = 2) #.201
# points(x = 0.71457143, y = 0.1576667, col = "gray20", cex = 1.5, pch = 1, lwd = 2) #.157
# text("F/I =.201", x = .26, y = .19, pos = 1,  col = "gray20")
# text("F/I =.157", x = .71, y = .15, pos = 1,  col = "gray20")

mtext(paste("Base Case, one species"), side = 3, line = .6, cex = 1.3, col = "gray20")
#mtext("Revenue", side = 3, line = .8, cex = 1.5, col = "gray20")

#############################################################
### PLOTTING TWO=====
tracker<- tracker + 1

plot(x = plottingsp1[,1], y = plottingsp1[,2], col = "firebrick3",
     #ylim = c(min(plotthis[,c(2,3)])-.05, max(plotthis[,c(2,3)])+.1),
     ylim = c(0,1),
     xaxt = "n", yaxt = "n", ann = FALSE,
     # xlab = "Price ratio", ylab = "Final/Initial population size",
     cex = 1.5)
lines(x = plottingsp1[,1], y = plottingsp1[,3], col = "firebrick3")
lines(x = plottingsp1[,1], y = plottingsp1[,4], col = "firebrick3")

box(col = "gray29")
axis(side = 1, seq(from = 0, to = 250, by = 50), col.ticks = "gray29", col.axis = "gray29" )
#mtext("Revenue ratio", side = 1, line = 2.5, cex = 1.2, col = "gray20")
mtext("Year", side = 1, line = 2.5, cex = 1.2, col = "gray20")
if(tracker%%numcol == 0){
  axis(at = c(0, .2,.4, .6, .8, 1), side = 2, col.ticks = "gray29", col.axis = "gray29" )
  mtext("Final / Initial Population Size", side = 2, line = 2.5, cex = 1.2, col = "gray20")
}
axis(at = c(0, .2,.4, .6, .8, 1), side = 2, col.ticks = "gray29", col.axis = "gray29", labels = FALSE)
points(x= plottingsp2[,1], y = plottingsp2[,2], col = "dodgerblue3", cex = 1.5)
lines(x = plottingsp2[,1], y = plottingsp2[,3], col = "dodgerblue3")
lines(x = plottingsp2[,1], y = plottingsp2[,4], col = "dodgerblue3")
#abline(h = max(plotthis[,2]), lty = 2, lwd = 3)
#abline(h = 0, lty = 2, lwd = 3)

# points(x = 0.26604082, y = .2013813, col = "gray20", cex = 1.5, pch = 1, lwd = 2) #.201
# points(x = 0.71457143, y = 0.1576667, col = "gray20", cex = 1.5, pch = 1, lwd = 2) #.157
# text("F/I =.201", x = .26, y = .19, pos = 1,  col = "gray20")
# text("F/I =.157", x = .71, y = .15, pos = 1,  col = "gray20")

mtext(paste("Two species"), side = 3, line = .6, cex = 1.3, col = "gray20")
#mtext("Revenue", side = 3, line = .8, cex = 1.5, col = "gray20")

dev.off()

plot(y = yearlysizematrixsp1[304,], x = 1:ncol(yearlysizematrixsp1), type = 'l', ylim = c(0,1))
lines(y = yearlysizematrixsp1onesp[304,], x = 1:ncol(yearlysizematrixsp1), col = "red")

plot(y = yearlysizematrixsp1[1,], x = 1:ncol(yearlysizematrixsp1), type = 'l', ylim = c(0,1))

pdf("allruns.pdf")
plot(y = yearlysizematrixsp1[1,], x = 1:ncol(yearlysizematrixsp1), type = 'l', ylim = c(0,1), main = "two species")
for (i in 2:500){
  lines(y = yearlysizematrixsp1[i,], x = 1:ncol(yearlysizematrixsp1),  col = i)
}

plot(y = yearlysizematrixsp1onesp[1,], x = 1:ncol(yearlysizematrixsp1onesp), type = 'l', ylim = c(0,1), main = "one species")
for (i in 2:500){
  lines(y = yearlysizematrixsp1onesp[i,], x = 1:ncol(yearlysizematrixsp1onesp),  col = i)
}
dev.off()

pdf("histogram.pdf")
diffplot<- yearlysizematrixsp1onesp[,ncol(yearlysizematrixsp1onesp)] - yearlysizematrixsp1[,ncol(yearlysizematrixsp1)]
#hist(diffplot)
hist(diffplot, main = "Difference in yr 300 f/i", xlab = "onesp yr 300 f/i - two sp yr 300 f/i")
dev.off()

pdf("yearextinct.pdf")

hist(extinctionyronesp, xlab = "Year extinct", main = "One Species")

hist(extinctionyr, xlab = "Year extinct", main = "Two Species")

hist(extinctionyr[which(extinctionyr>0)], xlab = "Year extinct", main = "Two Species, zoomed")

dev.off()

#################### big difference -- 33  49 168 170 195 260 300 327 344 366 369 382 404 408 413 423 434 456 500

plot(y = yearlysizematrixsp1[413,], x = 1:ncol(yearlysizematrixsp1), type = 'l', ylim = c(0,1))
lines(y = yearlysizematrixsp1onesp[413,], x = 1:ncol(yearlysizematrixsp1), col = "red")

##################### strong negative correlation - 2  4  5 10 18 21 26 40 47 51 66 70 73 97
diffplot[2]
diffplot[10]
diffplot[73]
diffplot[97]


plot(y = diffplot, x = Binssubset[,3], xlab = "habitat quality grid correlation", ylab = "difference between year 300 depletion")

length(which(Binssubset[,3]))